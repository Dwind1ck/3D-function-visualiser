#include "bitmap_font.h"
#include <GL/gl.h>

// Простой растровый шрифт 5x7 пикселей
unsigned char font_5x7[][7] = {
    // A
    {0x70, 0x88, 0x88, 0xF8, 0x88, 0x88, 0x88},
    // B
    {0xF0, 0x88, 0x88, 0xF0, 0x88, 0x88, 0xF0},
    // C
    {0x70, 0x88, 0x80, 0x80, 0x80, 0x88, 0x70},
    // D
    {0xF0, 0x88, 0x88, 0x88, 0x88, 0x88, 0xF0},
    // E
    {0xF8, 0x80, 0x80, 0xF0, 0x80, 0x80, 0xF8},
    // F
    {0xF8, 0x80, 0x80, 0xF0, 0x80, 0x80, 0x80},
    // G
    {0x70, 0x88, 0x80, 0x98, 0x88, 0x88, 0x70},
    // H
    {0x88, 0x88, 0x88, 0xF8, 0x88, 0x88, 0x88},
    // I
    {0x70, 0x20, 0x20, 0x20, 0x20, 0x20, 0x70},
    // J
    {0x38, 0x10, 0x10, 0x10, 0x90, 0x90, 0x60},
    // K
    {0x88, 0x90, 0xA0, 0xC0, 0xA0, 0x90, 0x88},
    // L
    {0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0xF8},
    // M
    {0x88, 0xD8, 0xA8, 0x88, 0x88, 0x88, 0x88},
    // N
    {0x88, 0xC8, 0xA8, 0x98, 0x88, 0x88, 0x88},
    // O
    {0x70, 0x88, 0x88, 0x88, 0x88, 0x88, 0x70},
    // P
    {0xF0, 0x88, 0x88, 0xF0, 0x80, 0x80, 0x80},
    // Q
    {0x70, 0x88, 0x88, 0x88, 0xA8, 0x90, 0x68},
    // R
    {0xF0, 0x88, 0x88, 0xF0, 0xA0, 0x90, 0x88},
    // S
    {0x70, 0x88, 0x80, 0x70, 0x08, 0x88, 0x70},
    // T
    {0xF8, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20},
    // U
    {0x88, 0x88, 0x88, 0x88, 0x88, 0x88, 0x70},
    // V
    {0x88, 0x88, 0x88, 0x50, 0x50, 0x20, 0x20},
    // W
    {0x88, 0x88, 0x88, 0xA8, 0xA8, 0xD8, 0x88},
    // X
    {0x88, 0x50, 0x20, 0x20, 0x50, 0x88, 0x88},
    // Y
    {0x88, 0x88, 0x50, 0x20, 0x20, 0x20, 0x20},
    // Z
    {0xF8, 0x08, 0x10, 0x20, 0x40, 0x80, 0xF8},
    // 0
    {0x70, 0x88, 0x98, 0xA8, 0xC8, 0x88, 0x70},
    // 1
    {0x20, 0x60, 0x20, 0x20, 0x20, 0x20, 0x70},
    // 2
    {0x70, 0x88, 0x08, 0x70, 0x80, 0x80, 0xF8},
    // 3
    {0x70, 0x88, 0x08, 0x30, 0x08, 0x88, 0x70},
    // 4
    {0x10, 0x30, 0x50, 0x90, 0xF8, 0x10, 0x10},
    // 5
    {0xF8, 0x80, 0xF0, 0x08, 0x08, 0x88, 0x70},
    // 6
    {0x70, 0x80, 0x80, 0xF0, 0x88, 0x88, 0x70},
    // 7
    {0xF8, 0x08, 0x10, 0x20, 0x40, 0x40, 0x40},
    // 8
    {0x70, 0x88, 0x88, 0x70, 0x88, 0x88, 0x70},
    // 9
    {0x70, 0x88, 0x88, 0x78, 0x08, 0x08, 0x70},
    // пробел
    {0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00},
    // +
    {0x00, 0x20, 0x20, 0xF8, 0x20, 0x20, 0x00},
    // -
    {0x00, 0x00, 0x00, 0xF8, 0x00, 0x00, 0x00},
    // *
    {0x00, 0x50, 0x20, 0xF8, 0x20, 0x50, 0x00},
    // /
    {0x08, 0x08, 0x10, 0x20, 0x40, 0x80, 0x80},
    // (
    {0x10, 0x20, 0x40, 0x40, 0x40, 0x20, 0x10},
    // )
    {0x40, 0x20, 0x10, 0x10, 0x10, 0x20, 0x40},
    // :
    {0x00, 0x60, 0x60, 0x00, 0x60, 0x60, 0x00},
    // =
    {0x00, 0x00, 0xF8, 0x00, 0xF8, 0x00, 0x00},
    // ^
    {0x20, 0x50, 0x88, 0x00, 0x00, 0x00, 0x00}
};

// Получить индекс символа в шрифте
int get_char_index(char c) {
    if (c >= 'A' && c <= 'Z') return c - 'A';
    if (c >= 'a' && c <= 'z') return c - 'a';
    if (c >= '0' && c <= '9') return 26 + (c - '0');
    switch(c) {
        case ' ': return 36;
        case '+': return 37;
        case '-': return 38;
        case '*': return 39;
        case '/': return 40;
        case '(': return 41;
        case ')': return 42;
        case ':': return 43;
        case '=': return 44;
        case '^': return 45;
        default: return 36; // пробел по умолчанию
    }
}

// Отрисовка символа
void draw_char_bitmap(float x, float y, char c, float scale) {
    int index = get_char_index(c);
    if (index >= sizeof(font_5x7)/sizeof(font_5x7[0])) return;
    
    for (int row = 0; row < 7; row++) {
        unsigned char line = font_5x7[index][row];
        for (int col = 0; col < 8; col++) {
            if (line & (0x80 >> col)) {
                float px = x + col * scale;
                float py = y + (6 - row) * scale;
                glBegin(GL_QUADS);
                glVertex2f(px, py);
                glVertex2f(px + scale, py);
                glVertex2f(px + scale, py + scale);
                glVertex2f(px, py + scale);
                glEnd();
            }
        }
    }
}

// Отрисовка строки текста
void draw_text_bitmap(float x, float y, const char* text, float scale) {
    float current_x = x;
    for (const char* c = text; *c != '\0'; c++) {
        draw_char_bitmap(current_x, y, *c, scale);
        current_x += 8 * scale + 2; // 8 пикселей ширина + отступ
    }
}